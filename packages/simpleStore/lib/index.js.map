{"version":3,"file":"index.js","sources":["../src/store.tsx"],"sourcesContent":["import React, { FC, createContext, useReducer, useContext, useCallback, Component } from 'react'\n\n// dispatch\nexport type IDispatch = (type: string, ...args: any) => void\n\n// 状态库入参 泛型入参\ninterface IStore<S, R, E> {\n  state: S\n  reducers: any\n  effects: any\n}\n\n// reducer方法\ninterface IReducer<S, D> {\n  [key: string]: (state: S, data?: D) => S\n}\n\n// effects方法\ninterface IEffect<D> {\n  [key: string]: (data?: D, dispatch?: IDispatch) => void\n}\n\ninterface IAction {\n  type: string // action名\n  [key: string]: any\n}\n\ninterface IContextWidthDispatch {\n  dispatch: IDispatch\n}\n\ninterface IContext<S> {\n  [key: string]: S\n}\n\nconst Store = <S, R, E>(namespace: string, props: IStore<S, R, E>) => {\n  const { state, reducers, effects } = props\n\n  const Context = createContext<IContext<S> & IContextWidthDispatch|null>(null)\n\n  const Provider: FC = ({ children }) => {\n    const [providerState, dispatch] = useReducer((state: S, action: IAction) => {\n      const { type, ...args } = action\n      if (reducers && reducers.hasOwnProperty(type)) {\n        // 自己包装的reducers\n        return reducers[type](state, args)\n      }\n      return state\n    }, state)\n\n    // 包装dispatch\n    const _dispatch = useCallback((type, args) => {\n      if (effects && effects.hasOwnProperty(type)) {\n        effects[type].call(null, args, dispatch)\n      } else if (reducers && reducers.hasOwnProperty(type)) {\n        dispatch({ type, ...args })\n      }\n    }, [])\n\n    return <Context.Provider value={{ [namespace]: providerState, dispatch: _dispatch }}>{children}</Context.Provider>\n  }\n\n  const connect = (Component: any) => {\n    const NewComponent = (props: any) => {\n      const context = useContext(Context)\n      const newProps = { ...props, ...context }\n      return <Component {...newProps} />\n    }\n    return NewComponent\n  }\n\n  // 返回值\n  return {\n    Provider,\n    Context,\n    connect,\n  }\n}\n\nexport default Store\n"],"names":["namespace","props","state","reducers","effects","Context","createContext","Provider","_a","children","_c","useReducer","action","type","args","hasOwnProperty","providerState","dispatch","_dispatch","useCallback","call","React","value","_b","connect","Component","context","useContext","newProps"],"mappings":"sJAmCc,SAAUA,EAAmBC,OACjCC,EAA6BD,QAAtBE,EAAsBF,WAAZG,EAAYH,UAE/BI,EAAUC,EAAwD,YAkCjE,CACLC,SAjCmB,SAACC,SAAEC,aAChBC,EAA4BC,GAAW,SAACT,EAAUU,OAC9CC,EAAkBD,OAATE,IAASF,EAApB,iBACFT,GAAYA,EAASY,eAAeF,GAE/BV,EAASU,GAAMX,EAAOY,GAExBZ,IACNA,GAPIc,OAAeC,OAUhBC,EAAYC,GAAY,SAACN,EAAMC,GAC/BV,GAAWA,EAAQW,eAAeF,GACpCT,EAAQS,GAAMO,KAAK,KAAMN,EAAMG,GACtBd,GAAYA,EAASY,eAAeF,IAC7CI,KAAWJ,QAASC,MAErB,WAEIO,gBAAChB,EAAQE,UAASe,YAASC,EAACvB,GAAYgB,EAAeO,WAAUL,MAAcT,IAetFJ,UACAmB,QAbc,SAACC,UACM,SAACxB,OACdyB,EAAUC,EAAWtB,GACrBuB,SAAgB3B,GAAUyB,UACzBL,gBAACI,OAAcG"}