{"version":3,"file":"index.js","sources":["../src/index.ts","../src/store.tsx"],"sourcesContent":["import { createContext, useContext } from 'react'\nimport storeWrapper, { IDispatch, IEffect, IReducer, TContextWidthDispatch } from './store'\n\n// 状态库入参 泛型入参\nexport interface IStore<S, D> {\n  state: S\n  reducers: IReducer<S, D>,\n  effects: IEffect<D>\n}\n\nconst Store = <S, D>(namespace: string, props: IStore<S, D>) => {\n  const { state, reducers, effects } = props\n  const Context = createContext<TContextWidthDispatch<S, D> | null>(null)\n  const [Provider, connect] = storeWrapper<S, D>({ Context, namespace, state, reducers, effects })\n  function useSimpleContext(): [S, IDispatch<D>] {\n    const context = useContext<TContextWidthDispatch<S, D> | null>(Context)\n    const nextState = context ? (context[namespace] as S) : state\n    return [nextState, (context?.dispatch as IDispatch<D>)]\n  }\n  // 返回值\n  return {\n    Provider,\n    Context,\n    connect,\n    useSimpleContext,\n  }\n}\n\nexport { IDispatch, IEffect, IReducer, TContextWidthDispatch }\n\nexport default Store\n","import React, { FC, useReducer, useContext, useCallback } from 'react'\n\nexport type IDispatch<D> = (type: string, payload?: TPayload<D> | D) => void\n\nexport type TPayload<D> = {\n  [P in keyof D]?: D[P];\n}\n\nexport interface IAction<D> {\n  type: string // action名\n  payload?: TPayload<D>\n}\n\n// reducer方法\nexport interface IReducer<S, D> {\n  [key: string]: (state: S, data?: TPayload<D>) => S\n}\n\n// effects方法\nexport interface IEffect<D> {\n  [key: string]: (data?: TPayload<D>, dispatch?: IDispatch<D>) => void\n}\n\nexport type TContextWidthDispatch<S, D> = {\n  dispatch: IDispatch<D>\n  [key: string]: S | IDispatch<D>\n}\n\ninterface IProps<S, D> {\n  Context: React.Context<TContextWidthDispatch<S, D> | null>\n  namespace: string\n  state: S\n  reducers: IReducer<S, D>\n  effects: IEffect<D>\n}\n\n// { [x: string]: S | IDispatch<D>; dispatch: IDispatch<D>; }\n\nfunction storeWrapper<S, D>({\n  Context,\n  namespace,\n  state,\n  reducers,\n  effects,\n}: IProps<S, D>): [React.FC<any>, any] {\n  const Provider: FC = ({ children }) => {\n    const [providerState, dispatch] = useReducer((state: S, action: IAction<D>) => {\n      const { type, payload } = action\n      if (reducers && reducers.hasOwnProperty(type)) {\n        // 自己包装的reducers\n        return reducers[type](state, payload)\n      }\n      return state\n    }, state)\n    // effect中的dispatch\n    const effectDispatch: IDispatch<D> = (type, payload) => {\n      dispatch({ type, payload })\n    }\n    // 包装dispatch\n    const _dispatch = useCallback<IDispatch<D>>((type, payload) => {\n      if (effects && effects.hasOwnProperty(type)) {\n        effects[type].call(null, payload, effectDispatch)\n      } else if (reducers && reducers.hasOwnProperty(type)) {\n        dispatch({ type, payload })\n      }\n    }, [])\n    return <Context.Provider value={{ [namespace]: providerState, dispatch: _dispatch }}> {children} </Context.Provider>\n  }\n  const connect = (Component: any) => {\n    const NewComponent = (props: any): JSX.Element => {\n      const context: any = useContext(Context)\n      const newProps = { ...props, ...context }\n      return <Component {...newProps} />\n    }\n    return NewComponent\n  }\n  return [Provider, connect]\n}\n\nexport default storeWrapper\n"],"names":["namespace","props","state","reducers","effects","Context","createContext","_a","children","_c","useReducer","action","type","payload","hasOwnProperty","providerState","dispatch","effectDispatch","_dispatch","useCallback","call","React","Provider","value","_b","Component","context","useContext","newProps","storeWrapper","connect","useSimpleContext"],"mappings":"0IAUc,SAAOA,EAAmBC,OAC9BC,EAA6BD,QAAtBE,EAAsBF,WAAZG,EAAYH,UAC/BI,EAAUC,EAAkD,MAC5DC,ECyBR,SAA4BA,OAC1BF,YACAL,cACAE,UACAC,aACAC,kBAiCO,CA/Bc,SAACG,SAAEC,aAChBC,EAA4BC,GAAW,SAACR,EAAUS,OAC9CC,EAAkBD,OAAZE,EAAYF,iBACtBR,GAAYA,EAASW,eAAeF,GAE/BT,EAASS,GAAMV,EAAOW,GAExBX,IACNA,GAPIa,OAAeC,OAShBC,EAA+B,SAACL,EAAMC,GAC1CG,EAAS,CAAEJ,OAAMC,aAGbK,EAAYC,GAA0B,SAACP,EAAMC,GAC7CT,GAAWA,EAAQU,eAAeF,GACpCR,EAAQQ,GAAMQ,KAAK,KAAMP,EAASI,GACzBd,GAAYA,EAASW,eAAeF,IAC7CI,EAAS,CAAEJ,OAAMC,cAElB,WACIQ,gBAAChB,EAAQiB,UAASC,YAASC,EAACxB,GAAYe,EAAeS,WAAUN,UAAeV,QAEzE,SAACiB,UACM,SAACxB,OACdyB,EAAeC,EAAWtB,GAC1BuB,SAAgB3B,GAAUyB,UACzBL,gBAACI,OAAcG,OD3DEC,CAAmB,CAAExB,UAASL,YAAWE,QAAOC,WAAUC,YAA/EkB,OAAUQ,aAOV,CACLR,WACAjB,UACAyB,UACAC,gCATML,EAAUC,EAA+CtB,SAExD,CADWqB,EAAWA,EAAQ1B,GAAmBE,EACpCwB,MAAAA,SAAAA,EAASV"}