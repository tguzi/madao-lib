{"version":3,"file":"index.js","sources":["../src/utils.ts","../src/useStorageState.ts","../src/altStorageState.ts","../src/cacheStorage.ts","../src/index.ts"],"sourcesContent":["export function isFunction<T>(obj: any): obj is T {\n  return typeof obj === 'function'\n}\n","import { useState, useEffect, useRef } from 'react'\nimport { isFunction } from './utils'\n\nimport {\n  IFuncUpdater,\n  TStorageStateDefaultValue,\n  TStorageStateResult\n} from './types'\n\nfunction useStorageState<T>(storage: Storage, key: string, defaultValue?: TStorageStateDefaultValue<T>): TStorageStateResult<T> {\n  const isMounted = useRef(false)\n  const [state, setState] = useState<T | undefined>(() => getStoredValue())\n\n  useEffect(() => {\n    if (!isMounted.current) {\n      isMounted.current = true\n      return\n    }\n    setState(getStoredValue())\n  }, [key])\n\n  function getStoredValue() {\n    const raw = storage.getItem(key)\n    if (raw) {\n      try {\n        return JSON.parse(raw)\n      } catch (e) { }\n    }\n    if (isFunction<IFuncUpdater<T>>(defaultValue)) {\n      return defaultValue()\n    }\n    return defaultValue\n  }\n\n  function updateState(value?: T | IFuncUpdater<T>) {\n    if (isFunction<IFuncUpdater<T>>(value)) {\n      const previousState = getStoredValue()\n      const currentState = value(previousState)\n      storage.setItem(key, JSON.stringify(currentState))\n      setState(currentState)\n    } else {\n      storage.setItem(key, JSON.stringify(value))\n      setState(value)\n    }\n  }\n\n  function deleteState() {\n    setState(undefined)\n    storage.removeItem(key)\n  }\n\n  return [state, updateState, deleteState]\n}\n\nexport default useStorageState\n","import { isFunction } from './utils'\n\nimport {\n  IFuncUpdater,\n  TStorageStateDefaultValue,\n  TStorageStateResult\n} from './types'\n\nfunction altStorageState<T>(storage: Storage, key: string, defaultValue?: TStorageStateDefaultValue<T>): TStorageStateResult<T> {\n\n  function getStoredValue() {\n    const raw = storage.getItem(key)\n    if (raw) {\n      try {\n        return JSON.parse(raw)\n      } catch (e) { }\n    }\n    if (isFunction<IFuncUpdater<T>>(defaultValue)) {\n      return defaultValue()\n    }\n    return defaultValue\n  }\n\n  function updateState(value?: T | IFuncUpdater<T>) {\n    if (isFunction<IFuncUpdater<T>>(value)) {\n      const previousState = getStoredValue()\n      const currentState = value(previousState)\n      storage.setItem(key, JSON.stringify(currentState))\n    } else {\n      storage.setItem(key, JSON.stringify(value))\n    }\n  }\n\n  function deleteState() {\n    storage.removeItem(key)\n  }\n\n  const state = getStoredValue()\n\n  return [state, updateState, deleteState]\n}\n\nexport default altStorageState\n","class MapStorage {\n  private storage = new Map()\n\n  length = 0\n\n  getItem(key: string) {\n    return this.storage.has(key) && this.storage.get(key)\n  }\n\n  setItem(key: string, value: any) {\n    this.storage.set(key, value)\n    this.updateLength()\n  }\n\n  removeItem(key: string) {\n    this.storage.delete(key)\n    this.updateLength()\n  }\n\n  clear() {\n    this.storage.clear()\n    this.updateLength()\n  }\n\n  updateLength() {\n    this.length = this.storage.size\n  }\n\n  key(index: number) {\n    const keys = this.storage.keys()\n    let key: string | null = null\n    if (index > this.storage.size) {\n      return key\n    }\n    for (let i = 0; i < this.storage.size; i++) {\n      const result = keys.next()\n      if (i === index) {\n        key = result.value\n        break\n      }\n    }\n    return key\n  }\n\n}\n\nexport default new MapStorage()\n","/* eslint-disable indent */\nimport useStorageState from './useStorageState'\nimport altStorageState from './altStorageState'\nimport cache from './cacheStorage'\n\n// hooks场景 - 使用localStorage缓存\nexport function useLocalStorageState<T>(key: string, defaultValue?: T | (() => T)) {\n  return useStorageState(localStorage, key, defaultValue)\n}\n// 非hooks场景 - 使用localStorage缓存\nexport function altLocalStorageState<T>(key: string, defaultValue?: T | (() => T)) {\n  return altStorageState(localStorage, key, defaultValue)\n}\n\n// hooks场景 - 使用sessionStorage缓存\nexport function useSessionStorageState<T>(key: string, defaultValue?: T | (() => T)) {\n  return useStorageState(sessionStorage, key, defaultValue)\n}\n// 非hooks场景 - 使用sessionStorage缓存\nexport function altSessionStorageState<T>(key: string, defaultValue?: T | (() => T)) {\n  return altStorageState(sessionStorage, key, defaultValue)\n}\n\n// hooks场景 - 使用自定义缓存[map]\nexport function usecacheStorageState<T>(key: string, defaultValue?: T | (() => T)) {\n  return useStorageState(cache, key, defaultValue)\n}\n// 非hooks场景 - 使用自定义缓存[map]\nexport function altCacheStorageState<T>(key: string, defaultValue?: T | (() => T)) {\n  return altStorageState(cache, key, defaultValue)\n}\n\n// 导出默认的缓存方法\nexport default {\n  useStorageState,\n  altStorageState\n}\n"],"names":["isFunction","obj","useStorageState","storage","key","defaultValue","isMounted","useRef","_a","useState","getStoredValue","state","setState","useEffect","current","raw","getItem","JSON","parse","e","updateState","value","previousState","currentState","setItem","stringify","deleteState","undefined","removeItem","altStorageState","Map","MapStorage","has","get","set","updateLength","delete","clear","length","size","index","keys","i","result","next","useLocalStorageState","localStorage","altLocalStorageState","useSessionStorageState","sessionStorage","altSessionStorageState","usecacheStorageState","cache","altCacheStorageState"],"mappings":"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"}